<!DOCTYPE html>
<html style="height:100%;">
<head>
<!--{if $isGbk}-->
<meta http-equiv="Content-Type" content="text/html; charset=GBK">
<!--{else}-->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--{/if}-->
<meta name="viewport" content="width=device-width,height=device-height,inital-scale=1.0,maximum-scale=1.0,user-scalable=no;">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="format-detection" content="telephone=no">
<title>{$yaoyiyaoInfo['title']}</title>  
<link href="source/plugin/tom_yaoyiyao/images/style.css" rel="stylesheet" type="text/css" />
<link href="source/plugin/tom_yaoyiyao/images/ycj.css" rel="stylesheet" type="text/css" />
<style type="text/css">
.text{ margin-bottom:10px}
.rule {bottom: 15px !important;}
</style>
<script src="source/plugin/tom_yaoyiyao/images/jquery-1.js" type="text/javascript"></script>
<script src="source/plugin/tom_yaoyiyao/images/fleaves.min.js" type="text/javascript"></script>
<link href="source/plugin/tom_yaoyiyao/images/leavesGeneral.css" rel="stylesheet" type="text/css" media="screen" charset="utf-8">
<script type="text/javascript">
    var commonjspath = 'source/plugin/tom_yaoyiyao/images';
</script>
<script src="source/plugin/tom_yaoyiyao/images/common.js" type="text/javascript"></script>
<script>
var leafNum = 20;
var kindNum = 5;
var kindurl = new Array("source/plugin/tom_yaoyiyao/images/19.png","source/plugin/tom_yaoyiyao/images/20.png","source/plugin/tom_yaoyiyao/images/18.png","source/plugin/tom_yaoyiyao/images/12.png","source/plugin/tom_yaoyiyao/images/16.png");
</script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js" type="text/javascript"></script>
</head>
<body style="margin:0; height: 100%; background-color:#e84144;">
<audio id="yao" src="source/plugin/tom_yaoyiyao/images/v4.mp3" preload="auto"  autoplay="autoplay"></audio>

<div id="mcovear" class="pop" style="display:none;">
  <div class="box">
  	<b class="closeb" onClick="document.getElementById('mcovear').style.display='none';window.flag = 1;" ></b>
    <h1>{lang tom_yaoyiyao:index_add_title}</h1>
    <div class="inputqy">
      <form id="edit_form">
      <input type="text" id="xm" name="xm" placeholder="{lang tom_yaoyiyao:index_add_xm}" />
      <input type="text" id="tel" name="tel" placeholder="{lang tom_yaoyiyao:index_add_tel}" />
      <input type="hidden" name="act" value="edit">
      <input type="hidden" name="yao_id" value="{$yao_id}">
      <input type="hidden" name="user_id" value="{$user_id}">
      <input type="hidden" name="formhash" value="{$formhash}">
      </form>
    </div>
    <div class="but_con"  >
        <button class="button_yes" onClick="sendtel()">{lang tom_yaoyiyao:index_add_btn}</button>
      </div>
  </div>
</div>

<div id="zjl"  class="pop"  style="display:none;">
    <div class="box">
      <b class="closeb" onClick="document.getElementById('zjl').style.display='none';window.flag = 1;" ></b>
      <h1>{lang tom_yaoyiyao:index_zjl_title}</h1>
      <div class="inputqy">
      	<div class="jpimg"><img  id="jpimg" src="source/plugin/tom_yaoyiyao/images/share.jpg" /></div>
        <div class="jptext">
        	<p id="jptype">xxx</p>
        	<p id="jpname">xxxxxx</p>
        </div>
        </div>
        <div class="but_con">
          <!--{if $userInfo['add_tel'] == 0 }-->  
          <button class="button_yes" onClick="lq()">{lang tom_yaoyiyao:index_zjl_lq}</button>
          <!--{else}-->
          <button class="button_yes" onclick="javascript:window.location.href='{$infoUrl}#wdjp'">{lang tom_yaoyiyao:index_zjl_my}</button>
          <!--{/if}-->
        </div>
      </div>
</div>

<div id="mzj"  class="pop" style="display:none;">
  <div class="box">
    <h1></h1>
    <div class="inputqy">
      <div class="jptext">
          <span id="ncz" class="ncz">{lang tom_yaoyiyao:index_mzj_msg}</span>
      </div>
    </div>
    <div class="but_con"  >
        <button class="button_yes" onClick="document.getElementById('mzj').style.display='none';window.flag = 1;document.location.reload();">{lang tom_yaoyiyao:index_mzj_zdl}</button>
    </div>
  </div>
</div>

<div id="add"  class="pop" style="display:none;">
  <div class="box">
    <b class="closeb" onClick="document.getElementById('add').style.display='none';window.flag = 1;" ></b>
    <h1></h1>
    <div class="inputqy">
      <div class="jptext">
          <span id="addmsg" class="ncz">XXX</span>
      </div>
    </div>
    <div class="but_con">
        <button class="button_yes" onclick="javascript:window.location.href='{$bmUrl}'">{lang tom_yaoyiyao:index_add_add_btn}</button>
    </div>
  </div>
</div>

<div id="guanzu"  class="pop" style="display:none;">
  <div class="box">
    <b class="closeb" onClick="document.getElementById('guanzu').style.display='none';window.flag = 1;" ></b>
    <h1></h1>
    <div class="inputqy">
      <div class="jptext">
          <span class="ncz">{$yaoyiyaoInfo['guanzu_desc']}</span>
      </div>
    </div>
    <div class="but_con">
        <button class="button_yes" onclick="javascript:window.location.href='{$yaoyiyaoInfo['guanzu_url']}'">{lang tom_yaoyiyao:add_guanzu_btn}</button>
    </div>
  </div>
</div>

<div id="qttsxx"  class="pop" style="display:none;">
    <div class="box"><b class="closeb" onClick="document.getElementById('qttsxx').style.display='none';window.flag = 1;" ></b>
      <h1></h1>
      <div class="inputqy">
        <div class="jptext">
            <span id="qttsxxncz" class="ncz">XXX</span>
        </div>
      </div>
      <div class="but_con"  >
      </div>
    </div>
</div>
 
<div id="leafContainer" style="z-index:1;"></div>

<div class="rule">
    <button class="button" onclick="getjp();" style="background-color: #0A9130;margin-bottom: 5px;">{lang tom_yaoyiyao:index_not_yaoyiyao}</button>
	<div class="text">{$cjTimesMsg}</div>
	<button class="button" onclick="javascript:window.location.href='{$infoUrl}'">{lang tom_yaoyiyao:huodongguizhe}</button>
    <button class="button" onclick="javascript:window.location.href='{$infoUrl}#wdjp'">{lang tom_yaoyiyao:wodejiangping}</button> 
</div>

<div id="an-anim">
  <ol>
    <li id="an-scene-0" class="run t-0">
      <div class="an-stage">
        <div id="an-obj-1">
          <div><img  height="389" width="388"  src="source/plugin/tom_yaoyiyao/images/9.png"></div>
        </div>
        <div id="an-obj-2">
          <div><img  height="137" width="129"  src="source/plugin/tom_yaoyiyao/images/5.png"></div>
        </div>
        <div id="an-obj-3">
          <div><img  height="118" width="109"  src="source/plugin/tom_yaoyiyao/images/6.png"></div>
        </div>
        <div id="an-obj-4">
          <div><img  height="143" width="136"  src="source/plugin/tom_yaoyiyao/images/7.png"></div>
        </div>
        <div id="an-obj-5">
          <div><img  height="109" width="47"  src="source/plugin/tom_yaoyiyao/images/2.png"></div>
        </div>
        <div id="an-obj-6">
          <div><img  height="58" width="74"  src="source/plugin/tom_yaoyiyao/images/1.png"></div>
        </div>
        <div id="an-obj-7">
          <div><img  height="46" width="62"  src="source/plugin/tom_yaoyiyao/images/3.png"></div>
        </div>
        <div id="an-obj-8">
          <div><img  height="31" width="60"  src="source/plugin/tom_yaoyiyao/images/4.png"></div>
        </div>
        <div id="an-obj-9">
          <div><img  height="342" width="193"  src="source/plugin/tom_yaoyiyao/images/10.png"></div>
        </div>
        <div id="an-obj-10">
          <div><img  height="448" width="448"  src="source/plugin/tom_yaoyiyao/images/8.png"></div>
        </div>
        <div id="an-obj-11"></div>
        <div id="an-obj-12"></div>
        <div id="an-obj-13"></div>
        <div id="an-obj-14">
          <div id="yao_saizi"><img  height="217" width="443"  src="source/plugin/tom_yaoyiyao/images/22.png"></div>
        </div>
      </div>
    </li>
  </ol>
</div>

<script>
function changesize(id){
	document.getElementById(id).style.cssText = " -webkit-transform:scale("+(document.body.clientWidth/640) +");";
}
window.onresize = function(){ 
 	changesize("an-anim");
}
changesize("an-anim");

var flag = 1;
$(document).ready(function() {
	var SHAKE_THRESHOLD = 1300;
	var last_update = 0;
	var x = y = z = last_x = last_y = last_z = 0;
	if(window.DeviceMotionEvent) {
		window.addEventListener('devicemotion', deviceMotionHandler, false);
	}else{
		alert('{lang tom_yaoyiyao:index_no_yaoyiyao}');
		$('#leafContainer').click(function(){
			if(window.flag==1){
				getjp();
			}
		});
	}
	 
	function deviceMotionHandler(eventData) {
		var acceleration = eventData.accelerationIncludingGravity;
		var curTime = new Date().getTime();
		if((curTime - last_update) > 100) {
			var diffTime = curTime - last_update;
			last_update = curTime;
			x = acceleration.x;
			y = acceleration.y;
			z = acceleration.z;
			var speed = Math.abs(x + y + z - last_x - last_y - last_z) / diffTime * 10000;
			if(speed > SHAKE_THRESHOLD) {
				document.getElementById('yao').play();
				if(window.flag == 1) {
					window.flag =0;
					setTimeout("getjp()",1000);
				}
			};
			last_x = x;
			last_y = y;
			last_z = z;
		};
	};
	
	$('#yao_saizi').click(function(){
		if(window.flag==1){
			getjp();
		}
	});
});

var submintCjStatus = 0;
function getjp(){
    
    <!--{if $showGuanzuBox == 1 }-->
    $('#guanzu').show();
    window.flag =0;
    return false;
    <!--{/if}-->
    
    <!--{if $bmStatus == 0 }-->
    $('#add').show();
    $('#addmsg').html('{lang tom_yaoyiyao:index_no_add}');
    window.flag =0;
    return false;
    <!--{/if}-->

    <!--{if $showBtnBox == 2 }-->
    $('#qttsxx').show();
    $('#qttsxxncz').html('{lang tom_yaoyiyao:add_nostart}');
    window.flag =0;
    return false;
    <!--{/if}-->

    <!--{if $showBtnBox == 3 }-->
    $('#qttsxx').show();
    $('#qttsxxncz').html('{lang tom_yaoyiyao:add_end}');
    window.flag =0;
    return false;
    <!--{/if}-->
    
    submintCjStatus = 1;
	$.ajax({
		url : "{$ajaxCjUrl}",
		type : "GET",
		dataType : "json",
		data : {},
		beforeSend : function(){
			$('#zjl').hide();
			$('#mzj').hide();			
		},
		success : function(data){
            submintCjStatus = 0;
			if(data.status == 200) {
				$('#zjl').show();
				$('#jpimg').attr("src",data.pic_url);
				$('#jptype').html(data.title);
				$('#jpname').text(data.desc);
				 leafinit();
			}else if(data.status == 301){
                $('#mzj').show();
				$('#ncz').text("{lang tom_yaoyiyao:add_end}");
 				window.flag =0;
            }else if(data.status == 302){
                $('#mzj').show();
				$('#ncz').text("{lang tom_yaoyiyao:add_nostart}");
 				window.flag =0;
            }else if(data.status == 303){
                $('#mzj').show();
				$('#ncz').text("{lang tom_yaoyiyao:index_yao_error303}");
 				window.flag =0;
            }else if(data.status == 400){
                $('#mzj').show();
				$('#ncz').text("{lang tom_yaoyiyao:index_yao_error400}");
 				window.flag =0;
            }else if(data.status == 100){
                $('#mzj').show();
				$('#ncz').text("{lang tom_yaoyiyao:index_yao_error100}");
 				window.flag =0;
            }else if(data.status == 501){
                $('#mzj').show();
				$('#ncz').text("{lang tom_yaoyiyao:index_yao_error501}");
 				window.flag =0;
            }else {
				$('#mzj').show();
				$('#ncz').text("{lang tom_yaoyiyao:index_yao_error}");
 				window.flag =0;
			}
		},
		complete :function() { }
	});
 	window.flag =0;  
}

function lq(){
	$('#zjl').hide();
	document.getElementById('mcovear').style.display='block';
}

var submintUserStatus = 0;
function sendtel(){
	var xm = $("#xm").val();
    var tel = $("#tel").val();
    if(submintUserStatus == 1){
        return false;
    }
    if(xm == ""){
        tusi("{lang tom_yaoyiyao:add_must_xm}");
        return false;
    }
    
    if(tel == '' || !checkMobile(tel)){
        tusi("{lang tom_yaoyiyao:add_must_tel}");
        return false;
    }
    
    submintUserStatus = 1;
    $.ajax({
        type: "GET",
        url: "{$ajaxUrl}",
        data: $('#edit_form').serialize(),
        success: function(data){
            submintUserStatus = 0;
            if(data == 200){
                tusi("{lang tom_yaoyiyao:index_add_success}");
                setTimeout(function(){window.location.href='{$infoUrl}#wdjp';},1888);
            }else{
                tusi("{lang tom_yaoyiyao:index_add_error}");
            }
        }
    });
}

function checkMobile(s){
	var regu =/^[1][3|8|4|5|7][0-9]{9}$/;
	var re = new RegExp(regu);
	if (re.test(s)) {
		return true;
	}else{
		return false;
	}
}

wx.config({
    debug: false,
    appId: '{$wxJssdkConfig["appId"]}',
    timestamp: {$wxJssdkConfig["timestamp"]},
    nonceStr: '{$wxJssdkConfig["nonceStr"]}',
    signature: '{$wxJssdkConfig["signature"]}',
    jsApiList: [
      'onMenuShareTimeline',
      'onMenuShareAppMessage',
      'hideMenuItems'
    ]
});
wx.ready(function () {
    <!--{if $yaoConfig['yao_close_fz_llq'] == 1}-->
    wx.hideMenuItems({
        menuList: [
            'menuItem:copyUrl',
            'menuItem:openWithQQBrowser',
            'menuItem:share:email',
            'menuItem:openWithSafari' 
        ],
        success: function (res) {
        },
        fail: function (res) {
        }
    });
    <!--{/if}-->
    wx.onMenuShareTimeline({
        title: '{$shareTitle}',
        link: '{$shareUrl}', 
        imgUrl: '{$shareLogo}', 
        success: function () { 
            $.get("{$ajaxShareUrl}");
        },
        cancel: function () { 
        }
    });
    wx.onMenuShareAppMessage({
        title: '{$shareTitle}',
        desc: '{$shareDesc}',
        link: '{$shareUrl}',
        imgUrl: '{$shareLogo}',
        type: 'link',
        dataUrl: '',
        success: function () { 
            $.get("{$ajaxShareUrl}");
        },
        cancel: function () { 
        }
    });
});
</script>

</body>
</html>